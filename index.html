<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S.T.A.L.K.E.R. Квест-трекер</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #1a1a1a;
            color: #e0e0e0;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: #ff8c00;
            text-align: center;
            border-bottom: 2px solid #ff8c00;
            padding-bottom: 10px;
        }
        .quest-list {
            margin-bottom: 30px;
            background-color: #2a2a2a;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #ff8c00;
        }
        .daily-quests {
            border-left-color: #4CAF50;
        }
        .quest {
            margin: 10px 0;
            padding: 10px;
            background-color: #333;
            border-radius: 3px;
            display: flex;
            align-items: center;
        }
        .quest.completed {
            opacity: 0.7;
            background-color: #2a3333;
        }
        .quest-checkbox {
            margin-right: 15px;
            transform: scale(1.3);
        }
        .quest-info {
            flex-grow: 1;
        }
        .quest-giver {
            color: #8fbc8f;
            font-weight: bold;
        }
        .quest-location {
            color: #add8e6;
            font-style: italic;
        }
        .search {
            margin-bottom: 20px;
            padding: 10px;
            width: 100%;
            background-color: #333;
            color: white;
            border: 1px solid #ff8c00;
            border-radius: 4px;
        }
        .stats {
            background-color: #2a2a2a;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            text-align: center;
        }
        .quest-notes {
            color: #ffa07a;
            font-size: 0.9em;
            margin-top: 5px;
        }
        .section-title {
            color: #ff8c00;
            margin-top: 0;
        }
        .daily-title {
            color: #4CAF50;
        }
        .reset-daily {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 15px;
        }
        .location-title {
            color: #ff8c00;
            font-size: 1.2em;
            margin-top: 20px;
            border-bottom: 1px solid #ff8c00;
            padding-bottom: 5px;
        }
        .add-quest-form {
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-input {
            width: 100%;
            padding: 10px;
            background-color: #333;
            color: white;
            border: 1px solid #ff8c00;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .form-btn {
            background-color: #ff8c00;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
        }
        .user-quests {
            margin-top: 30px;
        }
        .quest-image {
            max-width: 200px;
            max-height: 200px;
            margin-top: 10px;
            display: block;
        }
        .user-quest {
            position: relative;
        }
        .delete-quest {
            position: absolute;
            right: 10px;
            top: 10px;
            background-color: #ff4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>S.T.A.L.K.E.R. Квест-трекер</h1>
    
    <div class="stats">
        <div>Выполнено: <span id="completed-count">0</span> из <span id="total-count">0</span> квестов</div>
        <progress id="quest-progress" value="0" max="100"></progress>
    </div>
    
    <input type="text" class="search" placeholder="Поиск квестов..." id="quest-search">

    <div class="add-quest-form">
        <h2 class="section-title">Добавить своё задание</h2>
        <div class="form-group">
            <input type="text" class="form-input" id="user-name" placeholder="Ваш никнейм">
        </div>
        <div class="form-group">
            <input type="text" class="form-input" id="quest-title" placeholder="Название задания">
        </div>
        <div class="form-group">
            <textarea class="form-input" id="quest-description" placeholder="Описание задания"></textarea>
        </div>
        <div class="form-group">
            <input type="file" id="quest-image" accept="image/*">
        </div>
        <button class="form-btn" id="add-quest-btn">Добавить задание</button>
    </div>

    <h2 class="section-title daily-title">Ежедневные квесты</h2>
    <button class="reset-daily" id="reset-daily">Сбросить ежедневные</button>
    
    <div class="quest-list daily-quests" id="daily-quests">
        <!-- Ежедневные квесты будут здесь -->
    </div>
    
    <h2 class="section-title">Основные квесты</h2>
    
    <div class="quest-list" id="main-quests">
        <!-- Основные квесты будут здесь -->
    </div>

    <div class="user-quests">
        <h2 class="section-title">Задания от сталкеров</h2>
        <div class="quest-list" id="user-quests-list">
            <!-- Пользовательские квесты будут здесь -->
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.2.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.0/firebase-storage.js"></script>
    
    <script>
        // Ваша конфигурация Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyYOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            databaseURL: "https://YOUR_PROJECT.firebaseio.com",
            projectId: "YOUR_PROJECT",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        
        // Инициализация Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const storage = firebase.storage();
        
        document.addEventListener('DOMContentLoaded', function() {
            // Инициализация квестов
            initializeQuests();
            
            // Элементы интерфейса
            const addQuestBtn = document.getElementById('add-quest-btn');
            const resetDailyBtn = document.getElementById('reset-daily');
            const searchInput = document.getElementById('quest-search');
            
            // Обработчики событий
            addQuestBtn.addEventListener('click', addUserQuest);
            resetDailyBtn.addEventListener('click', resetDailyQuests);
            searchInput.addEventListener('input', searchQuests);
            
            // Загрузка пользовательских квестов
            loadUserQuests();
            
            // Инициализация статистики
            updateStats();
        });
        
        function initializeQuests() {
            // Здесь должна быть инициализация стандартных квестов
            // Для краткости опущена, но должна включать все квесты из предыдущих примеров
        }
        
        function addUserQuest() {
            const userName = document.getElementById('user-name').value.trim();
            const questTitle = document.getElementById('quest-title').value.trim();
            const questDescription = document.getElementById('quest-description').value.trim();
            const imageFile = document.getElementById('quest-image').files[0];
            
            if (!userName || !questTitle) {
                alert('Заполните никнейм и название задания');
                return;
            }
            
            const newQuestRef = database.ref('userQuests').push();
            const questId = newQuestRef.key;
            
            if (imageFile) {
                const storageRef = storage.ref('quest_images/' + questId);
                storageRef.put(imageFile).then(snapshot => {
                    return snapshot.ref.getDownloadURL();
                }).then(imageUrl => {
                    saveQuestToDatabase(questId, userName, questTitle, questDescription, imageUrl);
                });
            } else {
                saveQuestToDatabase(questId, userName, questTitle, questDescription, null);
            }
        }
        
        function saveQuestToDatabase(questId, userName, title, description, imageUrl) {
            database.ref('userQuests/' + questId).set({
                userName: userName,
                title: title,
                description: description,
                imageUrl: imageUrl,
                completedBy: {},
                timestamp: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                alert('Задание добавлено!');
                document.getElementById('quest-title').value = '';
                document.getElementById('quest-description').value = '';
                document.getElementById('quest-image').value = '';
            });
        }
        
        function loadUserQuests() {
            database.ref('userQuests').on('value', snapshot => {
                const userQuests = snapshot.val();
                const userQuestsList = document.getElementById('user-quests-list');
                userQuestsList.innerHTML = '';
                
                if (userQuests) {
                    Object.entries(userQuests).forEach(([questId, questData]) => {
                        const questElement = document.createElement('div');
                        questElement.className = 'quest user-quest';
                        questElement.innerHTML = `
                            <button class="delete-quest" onclick="deleteUserQuest('${questId}')">×</button>
                            <input type="checkbox" class="quest-checkbox user-quest-checkbox" id="user-${questId}" 
                                   ${questData.completedBy ? 'checked' : ''}>
                            <div class="quest-info">
                                <span class="quest-name">${questData.title} (от ${questData.userName})</span>
                                <div class="quest-details">
                                    <span class="quest-description">${questData.description}</span>
                                    ${questData.imageUrl ? `<img src="${questData.imageUrl}" class="quest-image">` : ''}
                                </div>
                            </div>
                        `;
                        
                        const checkbox = questElement.querySelector('.quest-checkbox');
                        checkbox.addEventListener('change', function() {
                            toggleQuestCompletion(questId, this.checked);
                        });
                        
                        userQuestsList.appendChild(questElement);
                    });
                }
            });
        }
        
        function toggleQuestCompletion(questId, completed) {
            const userId = 'anonymous'; // Здесь можно добавить систему авторизации
            if (completed) {
                database.ref(`userQuests/${questId}/completedBy/${userId}`).set(true);
            } else {
                database.ref(`userQuests/${questId}/completedBy/${userId}`).remove();
            }
        }
        
        window.deleteUserQuest = function(questId) {
            if (confirm('Удалить это задание?')) {
                database.ref('userQuests/' + questId).remove();
            }
        };
        
        function resetDailyQuests() {
            // Логика сброса ежедневных квестов
        }
        
        function searchQuests() {
            const searchTerm = this.value.toLowerCase();
            document.querySelectorAll('.quest').forEach(quest => {
                const questText = quest.textContent.toLowerCase();
                quest.style.display = questText.includes(searchTerm) ? 'flex' : 'none';
            });
        }
        
        function updateStats() {
            // Логика обновления статистики
        }
    </script>
</body>
</html>
